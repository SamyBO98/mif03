<!doctype html>
<html lang="fr">
<head>
	<title>Présence UCBL</title>
	<meta charset="UTF-8">
	<style>
		.active { display: block; }
		.inactive { display: none; }
	</style>
	<script src="https://unpkg.com/mustache@latest"></script>
	<!-- local javascript files -->
	<script src="js/ajax.js"></script>
	<script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
	<script>
		function show(hash) {
			$('.active').removeClass('active').addClass('inactive');
			$(hash).removeClass('inactive').addClass('active');
		}
	</script>
</head>
<body>
<h1>Présence UCBL (en AJAX) !</h1>
<div id="errMsg"></div>

<aside>
	<h2>Menu</h2>
	<ul>
		<li><a href='#index'>Accueil</a></li>
		<li><a href='#monCompte'>Mon compte</a></li>
		<li><a href='#entree'>Entrée</a></li>
		<li><a href='#sortie'>Sortie</a></li>
		<li><a href='#passages'>Mes passages</a></li>
		<li><a href='#deco'>Déconnexion</a></li>
	</ul>
</aside>

<section id='index' class='active'>
    <div class="active" id="indexLogin">

        <h2>Connection sur Présence UCBL</h2>

		<input type="text" name="login" id="login">
		<input type="text" name="nom" id="nom">
		<button type="button" onclick="login()">Se connecter</button>

    </div>

    <!-- Si l'utilisateur est conecté, on affiche ses passages en cours -->
    <!-- De plus on rajoute un formulaire permettant de récupérer les informations d'une salle -->
    <div class='inactive' id="indexLogged">
        <div id="indexPassages">

            <h2>Vos passages en cours</h2>

            <ul id="indexPassagesAffichage"></ul>
            <script id="indexPassagesTemplate" type='x-tmpl-mustache'>
                Passage {{ . }}
            </script>

        </div>

        <div id="indexSalle">

            <h2>Rechercher une salle</h2>

            <div id="indexSalleAffichage"></div>
            <script id="indexSalleTemplate" type="x-tmpl-mustache">
                Salle {{ nomSalle }}<br/>
                Sa capacité est de {{ capacite }} personnes<br/>
                Il y a {{ presents }} personnes actuellement dans la salle<br/>
                Saturation: {{ saturee }}
            </script>

			<input type="text" id="indexSalleId">
			<button type="button" onclick="affichage('salle', 'indexSalleAffichage', 'indexSalleTemplate', true)">
				Rechercher la salle
			</button>

        </div>
    </div>

</section>




<!-----------------------------------------------------------------------------
---<< AFFICHAGE DU COMPTE + MISE A JOUR DU NOM DU COMPTE
------------------------------------------------------------------------------>
<section id='monCompte' class='inactive'>

	<h2>Mon compte</h2>

	<h3 id='monCompteAffichage'></h3>
	<script id='monCompteTemplate' type='x-tmpl-mustache'>
		<ul id='compteList'>
			<li>Login : <span id="monCompteLogin">{{ login }}</span></li>
			<li>Nom : <span id="monCompteNom">{{ nom }}</span></li>
			<li>Admin : <span id="monCompteAdmin">{{ admin }}</span></li>
		</ul>
    </script>

	<h2>Modifier le nom</h2>

	<input type="text" name="nom" id="nomUpdate">
	<button type="button" onclick="updateNom()">Modifier</button>

</section>


<!-----------------------------------------------------------------------------
---<< ENTREE D'UNE SALLE
------------------------------------------------------------------------------>
<section id='entree' class='inactive'>

	<h2>Entrée dans une salle</h2>

	<input type="text" name="salle" id="entreeSalle">
	<button type="button" onclick="updatePassage('entree')">Entrer dans la salle</button>

</section>


<!-----------------------------------------------------------------------------
---<< SORTIE D'UNE SALLE
------------------------------------------------------------------------------>
<section id='sortie' class='inactive'>

	<h2>Sortir d'une salle</h2>

	<input type="text" name="salle" id="sortieSalle">
	<button type="button" onclick="updatePassage('sortie')">Sortir de la salle</button>

</section>


<!-----------------------------------------------------------------------------
---<< AFFICHAGE DES PASSAGES
------------------------------------------------------------------------------>
<section id='passages' class='inactive'>

	<h2>Mes passages</h2>

	<ul id='passagesAffichage'></ul>
	<script id='passagesTemplate' type='x-tmpl-mustache'>
    	Passage {{ . }}
    </script>

</section>

<section id='deco' class='inactive'>

	<h2>Déconnexion</h2>

	<h3>Cliquez sur le bouton pour vous déconnecter</h3>
	<button type="button" onclick="logout()">Déconnexion</button>

</section>

<!-- MUSTACHE -->
<script>
	window.addEventListener('hashchange', () => {
		show(window.location.hash);
		//Cette fonction récupère la valeur du hash et appelle une certaine fonction selon ce qu'on a en valeur
		filterHash(window.location.hash);
	});
</script>
</body>
</html>
